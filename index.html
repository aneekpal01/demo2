<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Math Demo</title>
    <!-- KaTeX CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Header */
        header {
            background-color: white;
            padding: 1rem;
            text-align: center;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            color: #111827;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        /* Chat Area */
        #chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            max-width: 85%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            line-height: 1.5;
            font-size: 0.95rem;
            position: relative;
            word-wrap: break-word;
        }

        .user-message {
            align-self: flex-end;
            background-color: #2563eb;
            /* Blue */
            color: white;
            border-bottom-right-radius: 0.25rem;
        }

        .bot-message {
            align-self: flex-start;
            background-color: white;
            color: #1f2937;
            border: 1px solid #e5e7eb;
            border-bottom-left-radius: 0.25rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        /* Input Area */
        #input-area {
            background-color: white;
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 0.75rem;
        }

        #message-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 9999px;
            font-family: inherit;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }

        #message-input:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }

        #send-btn {
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 0 1.5rem;
            border-radius: 9999px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        #send-btn:hover {
            background-color: #1d4ed8;
        }

        /* KaTeX Overrides for Chat */
        .katex-display {
            margin: 0.5rem 0;
            overflow-x: auto;
            overflow-y: hidden;
        }

        /* Ensure KaTeX text in user bubble is readable (white text) */
        .user-message .katex {
            color: white;
        }
    </style>
</head>

<body>

    <header>
        LaTeX Chat Demo
    </header>

    <div id="chat-container">
        <div class="message bot-message">
            Hello! Ask me about physics formulas.
        </div>
    </div>

    <div id="input-area">
        <input type="text" id="message-input" placeholder="Type a message..." autofocus>
        <button id="send-btn">Send</button>
    </div>

    <!-- KaTeX Scripts -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const chatContainer = document.getElementById('chat-container');
            const messageInput = document.getElementById('message-input');
            const sendBtn = document.getElementById('send-btn');

            // --- KNOWLEDGE BASE ---
            // A simple "Brain" for our simulated AI
            const knowledgeBase = [
                {
                    keywords: ['hello', 'hi', 'hey', 'start'],
                    response: "Hello! I am ready to help you with Math & Physics. Ask me about **Gravity**, **Relativity**, **Calculus**, **Matrices**, **Thermodynamics**, or **Quantum Mechanics**!"
                },
                {
                    keywords: ['gravity', 'newton', 'force'],
                    response: "Here is Newton's Law of Universal Gravitation:\n\\[ F = G \\frac{m_1 m_2}{r^2} \\]"
                },
                {
                    keywords: ['relativity', 'einstein', 'energy', 'mass'],
                    response: "Einstein's Mass-Energy Equivalence principle:\n\\[ E = mc^2 \\]\n\nAnd the General Relativity field equation:\n\\[ R_{\\mu \\nu} - \\frac{1}{2}R g_{\\mu \\nu} = \\frac{8 \\pi G}{c^4} T_{\\mu \\nu} \\]"
                },
                {
                    keywords: ['integral', 'calculus', 'area', 'fundamental'],
                    response: "The Fundamental Theorem of Calculus links differentiation and integration:\n\\[ \\int_a^b f'(x) \\,dx = f(b) - f(a) \\]"
                },
                {
                    keywords: ['derivative', 'slope', 'rate'],
                    response: "The definition of a derivative:\n\\[ f'(x) = \\lim_{h \\to 0} \\frac{f(x+h) - f(x)}{h} \\]"
                },
                {
                    keywords: ['matrix', 'matrices', 'linear', 'algebra'],
                    response: "Here is a 2D Rotation Matrix:\n\\[ R(\\theta) = \\begin{pmatrix} \\cos \\theta & -\\sin \\theta \\\\ \\sin \\theta & \\cos \\theta \\end{pmatrix} \\]"
                },
                {
                    keywords: ['schrodinger', 'quantum', 'wave'],
                    response: "The Time-Dependent Schr√∂dinger Equation:\n\\[ i \\hbar \\frac{\\partial}{\\partial t} \\Psi = \\hat{H} \\Psi \\]"
                },
                {
                    keywords: ['maxwell', 'electromagnetism', 'magnetic', 'electric'],
                    response: "Maxwell's Equations (Integral form):\n\\[ \\oint_{\\partial \\Sigma} \\mathbf{E} \\cdot d\\boldsymbol{\\ell} = -\\frac{d}{dt} \\iint_{\\Sigma} \\mathbf{B} \\cdot d\\mathbf{S} \\]"
                },
                {
                    keywords: ['quadratic', 'roots', 'polynomial'],
                    response: "The Quadratic Formula for solving \\(ax^2 + bx + c = 0\\):\n\\[ x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a} \\]"
                },
                {
                    keywords: ['euler', 'identity', 'complex'],
                    response: "Euler's Identity, often called the most beautiful equation in math:\n\\[ e^{i\\pi} + 1 = 0 \\]"
                },
                {
                    keywords: ['pythagoras', 'triangle', 'geometry'],
                    response: "The Pythagorean Theorem:\n\\[ a^2 + b^2 = c^2 \\]"
                },
                {
                    keywords: ['circle', 'area of circle'],
                    response: "Area of a circle:\n\\[ A = \\pi r^2 \\]"
                },
                {
                    keywords: ['thermodynamics', 'entropy', 'heat'],
                    response: "The Second Law of Thermodynamics (Entropy):\n\\[ \\Delta S \\ge 0 \\]\n\nOr the Ideal Gas Law:\n\\[ PV = nRT \\]"
                },
                {
                    keywords: ['fourier', 'series', 'transform'],
                    response: "The Fourier Transform:\n\\[ \\hat{f}(\\xi) = \\int_{-\\infty}^{\\infty} f(x) e^{-2\\pi i x \\xi} \\,dx \\]"
                },
                {
                    keywords: ['standard deviation', 'statistics', 'stats'],
                    response: "Population Standard Deviation:\n\\[ \\sigma = \\sqrt{\\frac{1}{N} \\sum_{i=1}^N (x_i - \\mu)^2} \\]"
                },
                {
                    keywords: ['limit', 'infinity'],
                    response: "Standard limit definition of e:\n\\[ e = \\lim_{n \\to \\infty} \\left(1 + \\frac{1}{n}\\right)^n \\]"
                }
            ];

            const fallbackResponses = [
                "That's an interesting topic! Here is something related to Chaos Theory:\n\\[ x_{n+1} = r x_n (1 - x_n) \\]",
                "I'm not sure about that specific one, but check out the Normal Distribution:\n\\[ f(x) = \\frac{1}{\\sigma\\sqrt{2\\pi}} e^{-\\frac{1}{2}\\left(\\frac{x-\\mu}{\\sigma}\\right)^2} \\]",
                "Here is a cool vector identity for you:\n\\[ \\nabla \\cdot (\\nabla \\times \\mathbf{A}) = 0 \\]",
                "Let's look at the Taylor Series expansion instead:\n\\[ f(x) = \\sum_{n=0}^{\\infty} \\frac{f^{(n)}(a)}{n!} (x-a)^n \\]"
            ];

            function getBotResponse(input) {
                const lowerInput = input.toLowerCase();

                // 1. Check knowledge base
                for (const item of knowledgeBase) {
                    for (const keyword of item.keywords) {
                        if (lowerInput.includes(keyword)) {
                            return item.response;
                        }
                    }
                }

                // 2. Fallback to random smart formula
                const randomIndex = Math.floor(Math.random() * fallbackResponses.length);
                return fallbackResponses[randomIndex];
            }

            function renderMath(element) {
                renderMathInElement(element, {
                    delimiters: [
                        { left: '$$', right: '$$', display: true },
                        { left: '\\[', right: '\\]', display: true },
                        { left: '$', right: '$', display: false },
                        { left: '\\(', right: '\\)', display: false }
                    ],
                    throwOnError: false
                });
            }

            // Initial render
            renderMath(document.body);

            function addMessage(text, isUser) {
                const bubble = document.createElement('div');
                bubble.className = `message ${isUser ? 'user-message' : 'bot-message'}`;

                // Convert newlines to breaks for display
                bubble.innerHTML = text.replace(/\n/g, '<br>');

                chatContainer.appendChild(bubble);
                chatContainer.scrollTop = chatContainer.scrollHeight;

                renderMath(bubble);
            }

            function handleSend() {
                const text = messageInput.value.trim();
                if (!text) return;

                // User Message
                addMessage(text, true);
                messageInput.value = '';

                // AI Processing Delay
                setTimeout(() => {
                    const response = getBotResponse(text);
                    addMessage(response, false);
                }, 600 + Math.random() * 400); // Random delay 600-1000ms
            }

            sendBtn.addEventListener('click', handleSend);

            messageInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    handleSend();
                }
            });
        });
    </script>
</body>

</html>
